<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Sun</title>
<script src="suncalc.js"></script>
<style type="text/css">
html, body { width:100%; height:100%; overflow: hidden;} /* just to be sure these are full screen*/
</style>
</head>
<script>

var deg  = 180 / Math.PI;
var radius = 200;

function polar(r, al, az, north)
{
    return { x: -r * Math.sin(az+north) * Math.cos(al), y:r * Math.cos(az+north) * Math.cos(al)};
}

function DrawLine(context, date, lat, lng, north, color, align)
{
    var res = SunCalc.getPosition(date, lat, lng)
    var p = polar(radius, res.altitude, res.azimuth, north);
    context.beginPath();
    context.strokeStyle = color;
    context.lineWidth=5;
    context.moveTo(0,0); 
    context.lineTo(p.x,p.y); 
    context.moveTo(p.x,p.y); 
    
    if (align)
    {
        context.textAlign = align;
        context.fillText("  "+ date.toLocaleTimeString()+"  ",p.x,p.y);
    }
    
    context.stroke(); 
}

function SunPath(context, date, lat, lng, north, color, width)
{    
    var times = SunCalc.getTimes(date, lat, lng);
       
    context.beginPath();
    context.strokeStyle = color;
    context.lineWidth=width;
    for(var i=0;i<=50;i++)
    {
        var t = (i/50.0);
        time = times.sunset * t + times.sunrise * (1.0 - t);

        var res = SunCalc.getPosition(time, lat, lng)

        var p = polar(radius, res.altitude, res.azimuth, north);
        context.lineTo(p.x,p.y); 
    }
    context.stroke();     
}

Date.prototype.addDays = function(days) {
  var dat = new Date(this.valueOf());
  dat.setDate(dat.getDate() + days);
  return dat;
}

function DrawHemisphere(context, lat, lng, north)
{
    var date = new Date();

    var res = SunCalc.getPosition(date, lat, lng)
    
    var times = SunCalc.getTimes(date, lat, lng);
       
    SunPath(context, date, lat, lng, north, 'rgb(255, 219, 26)',5)
   
    DrawLine(context, times.sunrise, lat, lng, north, 'rgb(255, 219, 26)', "right")
    DrawLine(context, times.sunset, lat, lng, north, 'rgb(255, 143, 102)', "left")

    DrawLine(context, date, lat, lng, north, 'rgb(255, 174, 26)')

    var FirstJanuary = new Date(new Date().getFullYear(), 0, 1);    
    SunPath(context, FirstJanuary.addDays(171.6), lat, lng, north, '#000000', .5)
    SunPath(context, FirstJanuary.addDays(355.1), lat, lng, north, '#000000', .5)

}

function DrawAll(context, north)
{
    context.beginPath();
    context.lineWidth=2.5;
    context.arc(0,0,radius,0,2*Math.PI);
    context.stroke(); 

    context.beginPath();
    context.setLineDash([1, 2]);
    context.textAlign = "center";    
    var dirs = ["S","W", "N","E"]
    for(var i=0;i<4;i++)
    {
        context.moveTo(0,0); 
        
        p = polar(radius, 0, (i*90)/deg, north)                
        context.lineTo(p.x,p.y); 
        
        p = polar(radius+10, 0, (i*90)/deg, north)                
        context.fillText(dirs[i],p.x,p.y);
    }               
    context.stroke(); 

    context.setLineDash([]);
}

function init()
{
    window.addEventListener('resize', resizeCanvas, false);
    
    var myCanvas = document.getElementById("myCanvas");
    
    function resizeCanvas() 
    {
        var context = myCanvas.getContext('2d');

        myCanvas.width = window.innerWidth;
        myCanvas.height = window.innerHeight;
        
        context.clearRect(0, 0, myCanvas.width, myCanvas.height);        

        
        var transX = myCanvas.width * 0.5,
            transY = myCanvas.height * 0.5;

        context.translate(transX, transY);    
        
        var scale = transX/300;
        context.scale(scale,scale);   
        
        north = 180/deg;
        
        DrawAll(context, north);


        if (navigator.geolocation) 
        {
            navigator.geolocation.getCurrentPosition(function(position)
            {                
                DrawHemisphere(context, position.coords.latitude, position.coords.longitude, north);
            });
        } 
        else 
        { 
            DrawHemisphere(0, 0);
        }


    }
    resizeCanvas();
    
    
    
/*    
    if (window.DeviceOrientationEvent) 
    {
        window.addEventListener('deviceorientation', function(eventData) 
        {
            var north = eventData.alpha;
            
            if (eventData.alpha==null)
                north = 0;

            north += 90;
            
            north = north/deg;
        })
    }
*/    
    
    
}
</script>


<body onload="init()">
<canvas id="myCanvas" width="800" height="600"></canvas>
</body>
</html>
